{% extends "layout.html" %}

{% block content %}

<h2>Admin Dashboard</h2>

<div class="stats-grid">
    <div class="stat-card">
        <span class="stat-value">{{ total }}</span>
        <span class="stat-label">Total Feedback</span>
    </div>
    <div class="stat-card">
        <span class="stat-value">{{ avg_rating }}</span>
        <span class="stat-label">Average Rating</span>
    </div>
</div>

<div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
    <a href="/export-csv">
        <button type="button">Download CSV</button>
    </a>
    <a href="/">
        <button type="button" class="btn-secondary">Back to Home</button>
    </a>
</div>

<h3>Rating Distribution</h3>

<!-- Pass data using data-* attributes -->
<canvas id="ratingChart" data-labels='{{ labels | tojson }}' data-counts='{{ counts | tojson }}' width="400"
    height="200">
</canvas>

<br><br>

<div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Rating</th>
                <th>Comments</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for f in feedbacks %}
            <tr>
                <td data-label="Name">{{ f[1] }}</td>
                <td data-label="Email">{{ f[2] }}</td>
                <td data-label="Rating">{{ f[3] }}</td>
                <td data-label="Comments">{{ f[4] }}</td>
                <td data-label="Date">{{ f[5] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<div style="margin-top: 3rem; border-top: 2px solid var(--border-color); padding-top: 2rem;">
    <form method="POST" action="/clear-feedback"
        onsubmit="return confirm('⚠️ CRITICAL ACTION: This will permanently delete ALL feedback records. This cannot be undone. Are you sure you want to proceed?');">
        <button type="submit" class="btn-danger" style="width: auto;">Clear All Feedback Data</button>
    </form>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- External JS -->
<script src="{{ url_for('static', filename='js/chart.js') }}"></script>

{% endblock %}